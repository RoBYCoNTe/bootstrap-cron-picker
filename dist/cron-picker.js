"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();!function(t){var e=function(){function e(t,i,r){_classCallCheck(this,e),this.wrapper=t,this.hostControl=i,this.settings=r,this.state={type:"Daily",hours:0,minutes:0,dayNumber:1,monthRepeater:1,ordCondition:"#1",daysOfWeek:[],dayFilter:"day",dayOfWeek:"MON"},this._buildControl(),this.setCronExpression(this.hostControl.val())}return _createClass(e,[{key:"setCronExpression",value:function(t){t.length>0&&this._parseCronExpression(t),this._updateUI()}},{key:"_buildControl",value:function(){var e=t("<div>",{class:"cron-picker-container",html:[this._buildRecurrenceTypes(),this._buildDaysOfWeeks(),this._buildMonthlyFilter(),this._buildTimePicker()]});this.wrapper.append(e)}},{key:"_buildMonthlyFilter",value:function(){var i=this,r=this._buildFilterButton("day"),n=this._buildFilterButton("weekday"),s=t("<select>",{html:e._buildOptions(31,1),class:"form-control cron-picker-day-number"}).on("change",function(){i.state.dayNumber=this.value,i._buildCronExpression()}),a=t("<select>",{html:e._buildOptions(12,1),class:"form-control cron-picker-month-repeater"}).on("change",function(){i.state.monthRepeater=this.value,i._buildCronExpression()});return t("<div>",{class:"cron-picker-day-filter",html:[t("<div>",{class:"btn-group",html:[r,n]}),t("<div>",{class:"cron-picker-day-type-filter",html:[s,"day&nbsp;"]}),t("<div>",{class:"cron-picker-weekday-type-filter",html:[t("<select>",{class:"form-control cron-picker-ord-select",html:this._buildOrdinalityOptions()}).on("change",function(){i.state.ordCondition=this.value,i._buildCronExpression()}),t("<select>",{class:"form-control cron-picker-dow-select",html:this._buildDaysOfWeekOptions()}).on("change",function(){i.state.dayOfWeek=this.value,i._buildCronExpression()})]}),"of every",a,"month(s)"]})}},{key:"_buildOrdinalityOptions",value:function(){return[["First","#1"],["Second","#2"],["Third","#3"],["Last","L"]].map(function(e){return t("<option>",{value:e[1],text:e[0]})})}},{key:"_buildDaysOfWeekOptions",value:function(){return[["Sunday","SUN"],["Monday","MON"],["Tuesday","TUE"],["Wednesday","WED"],["Friday","FRI"],["Saturday","SAT"]].map(function(e){return t("<option>",{value:e[1],text:e[0]})})}},{key:"_buildFilterButton",value:function(e){var i=this;return t("<button>",{type:"button",class:"btn btn-default",text:e.toUpperCase(),"data-day-filter":e}).on("click",function(){i.state.dayFilter=this.getAttribute("data-day-filter"),i._buildCronExpression(),i._updateUI()})}},{key:"_buildTimePicker",value:function(){var i=this;return t("<div>",{class:"cron-picker-time",html:["Run at:",t("<select>",{html:e._buildOptions(24),class:"form-control cron-picker-hours"}).on("change",function(){i.state.hours=this.value,i._buildCronExpression()}),"-",t("<select>",{html:e._buildOptions(60),class:"form-control cron-picker-minutes"}).on("change",function(){i.state.minutes=this.value,i._buildCronExpression()})]})}},{key:"_buildRecurrenceTypes",value:function(){return t("<ul>",{class:"nav nav-pills cron-picker-recurrence-types",html:[this._buildRecurrenceType("Daily"),this._buildRecurrenceType("Weekly"),this._buildRecurrenceType("Monthly")]})}},{key:"_buildRecurrenceType",value:function(e){var i=this;return t("<li>",{"data-type":e,html:t("<a>",{text:e}).on("click",function(){i.state.type=this.parentNode.getAttribute("data-type"),i._buildCronExpression(),i._updateUI()})})}},{key:"_buildDaysOfWeeks",value:function(){var e=this;return t("<div>",{class:"cron-picker-dow",html:["SUN","MON","TUE","WED","THU","FRI","SAT"].map(function(t){return e._buildDayOfWeekButton(t)})})}},{key:"_buildDayOfWeekButton",value:function(e){var i=this;return t("<button>",{type:"button",class:"btn btn-default",text:e}).on("click",function(){var t=i.state.daysOfWeek.indexOf(this.innerText);t===-1?i.state.daysOfWeek.push(this.innerText):i.state.daysOfWeek.splice(t,1),i._buildCronExpression(),i._updateUI()})}},{key:"_parseCronExpression",value:function(t){var e=t.split(" ");7!==e.length?console.warn("Invalid cron expression. Skip parsing..."):(this.state.hours=e[2],this.state.minutes=e[1],"?"!==e[5]?(this.state.type="Weekly",this.state.daysOfWeek=e[5].split(",")):"*"!==e[4]?this.state.type="Monthly":this.state.type="Daily")}},{key:"_updateUI",value:function(){var t=this;this.wrapper.find("li").removeClass("active"),this.wrapper.find("[data-type="+this.state.type+"]").addClass("active"),this.wrapper.find("[data-day-filter]").removeClass("active"),this.wrapper.find("[data-day-filter="+this.state.dayFilter+"]").addClass("active"),this.wrapper.find(".cron-picker-dow > button.active").removeClass("active"),this.state.daysOfWeek.forEach(function(e){t.wrapper.find(".cron-picker-dow > button:contains('"+e+"')").addClass("active")}),this.wrapper.find(".cron-picker-minutes").val(this.state.minutes),this.wrapper.find(".cron-picker-hours").val(this.state.hours),this.wrapper.find(".cron-picker-dow-select").val(this.state.dayOfWeek),this.wrapper.find(".cron-picker-month-repeater").val(this.state.monthRepeater),this.wrapper.find(".cron-picker-ord-select").val(this.state.ordCondition),this.wrapper.find(".cron-picker-day-number").val(this.state.dayNumber),"Weekly"==this.state.type?this.wrapper.find(".cron-picker-dow").removeClass("hidden"):this.wrapper.find(".cron-picker-dow").addClass("hidden"),"Monthly"==this.state.type?this.wrapper.find(".cron-picker-day-filter").removeClass("hidden"):this.wrapper.find(".cron-picker-day-filter").addClass("hidden"),"day"==this.state.dayFilter?(this.wrapper.find(".cron-picker-day-type-filter").removeClass("hidden"),this.wrapper.find(".cron-picker-weekday-type-filter").addClass("hidden")):(this.wrapper.find(".cron-picker-day-type-filter").addClass("hidden"),this.wrapper.find(".cron-picker-weekday-type-filter").removeClass("hidden"))}},{key:"_buildCronExpression",value:function(){var t="";switch(this.state.type){case"Daily":t="0 "+this.state.minutes+" "+this.state.hours+" 1 * ? *";break;case"Weekly":var e=this.state.daysOfWeek;t="0 "+this.state.minutes+" "+this.state.hours+" ? * "+(e.length>0?e.join(","):"?")+" *";break;case"Monthly":"day"===this.state.dayFilter?t="0 "+this.state.minutes+" "+this.state.hours+" "+this.state.dayNumber+" 1/"+this.state.monthRepeater+" ? *":"weekday"==this.state.dayFilter&&(t="0 "+this.state.minutes+" "+this.state.hours+" ? 1/"+this.state.monthRepeater+" "+this.state.dayOfWeek+this.state.ordCondition+" *")}console.log(t),this.hostControl.val(t)}}],[{key:"_buildOptions",value:function(t,e){return e=e||0,[].concat(_toConsumableArray(Array(t).keys())).map(function(t){return'<option value="'+(t+e)+'">'+("0"+(t+e)).slice(-2)+"</option>"}).join()}}]),e}();t.fn.cronPicker=function(i){var r={},n=t.extend({},r,i);this.each(function(i,r){if(r=t(r),"1"!==r.data("cron-picker")){var s=t('\n                <div class="cron-picker">\n                </div>');return r.after(s).hide().data("cron-picker","1"),new e(s,r,n)}})}}(jQuery);