"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(t){var e=function(){function e(t,i,n){_classCallCheck(this,e),this.wrapper=t,this.hostControl=i,this.settings=n,this.state={type:"Daily",hours:0,minutes:0,daysOfWeek:[],dayFilter:"day"},this._buildControl(),this.setCronExpression(this.hostControl.val())}return _createClass(e,[{key:"setCronExpression",value:function(t){t.length>0&&this._parseCronExpression(t),this._updateUI()}},{key:"_setDayFilter",value:function(t){this.wrapper.find(".cron-picker-day-filter > button").removeClass("active"),this.wrapper.find("[data-day-filter="+t+"]").addClass("active")}},{key:"_buildControl",value:function(){var e=t("<div>",{class:"cron-picker-container",html:[this._buildRecurrenceTypes(),this._buildDaysOfWeeks(),this._buildMonthlyFilter(),this._buildTimePicker()]});this.wrapper.append(e)}},{key:"_buildMonthlyFilter",value:function(){return t("<div>",{class:"btn-group btn-group-sm cron-picker-day-filter",html:[t("<button>",{type:"button",class:"btn btn-default",text:"DAY","data-day-filter":"day"}),t("<button>",{type:"button",class:"btn btn-default",text:"WEEKDAY","data-day-filter":"weekday"})]})}},{key:"_buildTimePicker",value:function(){var i=this;return t("<div>",{class:"cron-picker-time",html:["Run at:",t("<select>",{html:e._buildOptions(24),class:"form-control cron-picker-hours"}).on("change",function(){i.state.hours=this.value,i._buildCronExpression()}),"-",t("<select>",{html:e._buildOptions(60),class:"form-control cron-picker-minutes"}).on("change",function(){i.state.minutes=this.value,i._buildCronExpression()})]})}},{key:"_buildRecurrenceTypes",value:function(){return t("<ul>",{class:"nav nav-pills cron-picker-recurrence-types",html:[this._buildRecurrenceType("Daily"),this._buildRecurrenceType("Weekly"),this._buildRecurrenceType("Monthly")]})}},{key:"_buildRecurrenceType",value:function(e){var i=this;return t("<li>",{"data-type":e,html:t("<a>",{text:e}).on("click",function(){i.state.type=this.parentNode.getAttribute("data-type"),i._buildCronExpression(),i._updateUI()})})}},{key:"_buildDaysOfWeeks",value:function(){return t("<div>",{class:"cron-picker-dow",html:[this._buildDayOfWeekButton("SUN"),this._buildDayOfWeekButton("MON"),this._buildDayOfWeekButton("TUE"),this._buildDayOfWeekButton("WED"),this._buildDayOfWeekButton("THU"),this._buildDayOfWeekButton("FRI"),this._buildDayOfWeekButton("SAT")]})}},{key:"_buildDayOfWeekButton",value:function(e){var i=this;return t("<button>",{type:"button",class:"btn btn-default btn-sm",text:e}).on("click",function(){var t=i.state.daysOfWeek.indexOf(this.innerText);t===-1?i.state.daysOfWeek.push(this.innerText):i.state.daysOfWeek.splice(t,1),i._buildCronExpression(),i._updateUI()})}},{key:"_parseCronExpression",value:function(t){var e=t.split(" ");7!==e.length?console.warn("Invalid cron expression. Skip parsing..."):(this.state.hours=e[2],this.state.minutes=e[1],"?"!==e[5]?(this.state.type="Weekly",this.state.daysOfWeek=e[5].split(",")):"*"!==e[4]?this.state.type="Monthly":this.state.type="Daily")}},{key:"_updateUI",value:function(){var t=this;this.wrapper.find(".cron-picker-minutes").val(this.state.minutes),this.wrapper.find(".cron-picker-hours").val(this.state.hours),this.wrapper.find("li").removeClass("active"),this.wrapper.find("[data-type="+this.state.type+"]").addClass("active"),"Weekly"==this.state.type?(this.wrapper.find(".cron-picker-dow").removeClass("hidden"),this.wrapper.find(".cron-picker-dow > button.active").removeClass("active"),this.state.daysOfWeek.forEach(function(e){t.wrapper.find(".cron-picker-dow > button:contains('"+e+"')").addClass("active")})):this.wrapper.find(".cron-picker-dow").addClass("hidden"),"Monthly"==this.state.type?this.wrapper.find(".cron-picker-day-filter").removeClass("hidden"):this.wrapper.find(".cron-picker-day-filter").addClass("hidden"),this._setDayFilter(this.state.dayFilter)}},{key:"_buildCronExpression",value:function(){var t="";switch(this.state.type){case"Daily":t="0 "+this.state.minutes+" "+this.state.hours+" 1 * ? *";break;case"Weekly":var e=this.state.daysOfWeek;t="0 "+this.state.minutes+" "+this.state.hours+" ? * "+(e.length>0?e.join(","):"?")+" *";break;case"Monthly":}console.log(t),this.hostControl.val(t)}}],[{key:"_buildOptions",value:function(t){return[].concat(_toConsumableArray(Array(t).keys())).map(function(t){return'<option value="'+t+'">'+("0"+t).slice(-2)+"</option>"}).join()}}]),e}();t.fn.cronPicker=function(i){var n={},s=t.extend({},n,i);this.each(function(i,n){if(n=t(n),"1"!==n.data("cron-picker")){var r=t('\n                <div class="cron-picker">\n                </div>');return n.after(r).hide().data("cron-picker","1"),new e(r,n,s)}})}}(jQuery);